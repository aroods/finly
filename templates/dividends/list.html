{% extends "base.html" %}
{% block content %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mb-4">
  <div>
    <h1 class="h3 fw-semibold mb-1">Dividend Tracker</h1>
    <p class="text-muted mb-0">Upcoming cash flows and historical payouts across your holdings.</p>
  </div>
  <div class="d-flex flex-column flex-sm-row align-items-stretch align-items-sm-center gap-2">
    <a class="btn btn-primary" href="{{ url_for('dividends.add_manual_dividend') }}">Add Manual Dividend</a>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-6">
    <div class="card">
      <div class="card-body">
        <p class="text-muted text-uppercase mb-1" style="font-size:.7rem; letter-spacing:.16em;">Upcoming net cash (est.)</p>
        <h3 class="fw-semibold text-highlight mb-0">{{ total_net_upcoming|format_currency() }}</h3>
        <span class="text-muted small">Assuming declared payouts and {{ (tax_rate * 100)|round(0) }}% withholding tax.</span>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-body">
        <p class="text-muted text-uppercase mb-1" style="font-size:.7rem; letter-spacing:.16em;">Net dividends (last 12 months)</p>
        <h3 class="fw-semibold text-highlight mb-0">{{ total_net_12m|format_currency() }}</h3>
        <span class="text-muted small">Recorded payouts after tax.</span>
      </div>
    </div>
  </div>
</div>

{% if upcoming %}
<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title mb-3">Upcoming Dividends</h5>
    <div class="table-responsive">
      <table class="table align-middle mb-0 table-striped">
        <thead>
          <tr>
            <th>Asset</th>
            <th>Ex Date</th>
            <th>Pay Date</th>
            <th class="text-end">Amount</th>
            <th class="text-end">Net / Share</th>
            <th class="text-end">Yield</th>
            <th class="text-end">Shares</th>
            <th class="text-end">Expected Net</th>
            <th>Status</th>
            <th>Source</th>
          </tr>
        </thead>
        <tbody>
          {% for d in upcoming %}
          <tr>
            <td class="fw-semibold">{{ d.asset }}</td>
            <td>{{ d.ex_date or '-' }}</td>
            <td>{{ d.pay_date or '-' }}</td>
            <td class="text-end">{{ d.amount|format_currency(d.currency) }}</td>
            <td class="text-end">{{ d.net_per_share|format_currency(d.currency) }}</td>
            <td class="text-end">{% if d.yield_pct %}{{ d.yield_pct|format_percentage }}{% else %}-{% endif %}</td>
            <td class="text-end">{% if d.shares %}{{ d.shares|format_number(4) if d.shares is not none else '-' }}{% else %}-{% endif %}</td>
            <td class="text-end">{% if d.total_net %}{{ d.total_net|format_currency(d.currency) }}{% else %}-{% endif %}</td>
            <td><span class="badge bg-{% if d.status == 'manual' %}info{% elif d.status == 'synced' %}success{% else %}secondary{% endif %}">{{ d.status|capitalize }}</span></td>
            <td class="text-muted small">{{ d.source }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endif %}

<div class="card">
  <div class="card-body">
    <h5 class="card-title mb-3">Dividend History</h5>
    <div class="table-responsive">
      <table class="table align-middle mb-0 table-striped">
        <thead>
          <tr>
            <th>Asset</th>
            <th>Ex Date</th>
            <th>Pay Date</th>
            <th class="text-end">Amount</th>
            <th class="text-end">Net / Share</th>
            <th class="text-end">Yield</th>
            <th class="text-end">Shares</th>
            <th class="text-end">Net Cash</th>
            <th>Status</th>
            <th>Source</th>
          </tr>
        </thead>
        <tbody>
          {% for d in history %}
          <tr>
            <td class="fw-semibold">{{ d.asset }}</td>
            <td>{{ d.ex_date or '-' }}</td>
            <td>{{ d.pay_date or '-' }}</td>
            <td class="text-end">{{ d.amount|format_currency(d.currency) }}</td>
            <td class="text-end">{{ d.net_per_share|format_currency(d.currency) }}</td>
            <td class="text-end">{% if d.yield_pct %}{{ d.yield_pct|format_percentage }}{% else %}-{% endif %}</td>
            <td class="text-end">{% if d.shares %}{{ d.shares|format_number(4) if d.shares is not none else '-' }}{% else %}-{% endif %}</td>
            <td class="text-end">{% if d.total_net %}{{ d.total_net|format_currency(d.currency) }}{% else %}-{% endif %}</td>
            <td><span class="badge bg-{% if d.status == 'manual' %}info{% elif d.status == 'synced' %}success{% else %}secondary{% endif %}">{{ d.status|capitalize }}</span></td>
            <td class="text-muted small">{{ d.source }}</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="10" class="text-center text-muted py-4">No dividend records yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
