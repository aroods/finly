{% extends "base.html" %}
{% block content %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mb-4">
  <div>
    <h1 class="h3 fw-semibold mb-1">Bond Portfolio</h1>
    <p class="text-muted mb-0">Monitor your treasury bond allocations, accrued interest and upcoming maturities.</p>
  </div>
  <a href="{{ url_for('bonds.add_bond') }}" class="btn btn-primary">Add Bond</a>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-6">
    <div class="card">
      <div class="card-body">
        <p class="text-muted text-uppercase mb-1" style="letter-spacing:.16em;font-size:.7rem;">Total Current Value</p>
        <h3 class="fw-semibold text-highlight mb-0">{{ "%.2f"|format(total_value) }} PLN</h3>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-body">
        <p class="text-muted text-uppercase mb-1" style="letter-spacing:.16em;font-size:.7rem;">Accrued Interest</p>
        <h3 class="fw-semibold text-profit-positive mb-0">{{ "%.2f"|format(total_accrued) }} PLN</h3>
      </div>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table align-middle mb-0 table-striped">
        <thead>
          <tr>
            <th>Series</th>
            <th>Type</th>
            <th>Purchase</th>
            <th>Maturity</th>
            <th class="text-end">Quantity</th>
            <th class="text-end">Unit Price</th>
            <th class="text-end">Nominal</th>
            <th class="text-end">Rate</th>
            <th class="text-end">Accrued</th>
            <th class="text-end">Current Value</th>
          </tr>
        </thead>
        <tbody>
          {% if bonds %}
            {% for bond, accrual in bonds %}
            <tr>
              <td class="fw-semibold">{{ bond.series }}</td>
              <td><span class="pill-badge">{{ bond.bond_type|title }}</span></td>
              <td>{{ bond.purchase_date.strftime('%Y-%m-%d') }}</td>
              <td>{{ bond.maturity_date.strftime('%Y-%m-%d') }}</td>
              <td class="text-end">{{ bond.quantity }}</td>
              <td class="text-end">{{ "%.2f"|format(bond.unit_price) }} PLN</td>
              <td class="text-end">{{ "%.2f"|format(bond.principal) }} PLN</td>
              <td class="text-end">{{ "%.2f"|format(accrual['effective_rate']) }}%</td>
              <td class="text-end">{{ "%.2f"|format(accrual['accrued_interest']) }} PLN</td>
              <td class="text-end">{{ "%.2f"|format(accrual['current_value']) }} PLN</td>
            </tr>
            <tr class="small text-muted">
              <td colspan="10">
                Days held: {{ accrual['days_held'] }} / {{ accrual['total_days'] }}&nbsp;&nbsp;•&nbsp;&nbsp;
                Capitalization: {{ 'Yes' if bond.capitalization else 'No' }}
                {% if bond.margin or bond.index_rate %}
                  &nbsp;&nbsp;•&nbsp;&nbsp; Margin: {{ "%.2f"|format(bond.margin) }} pp, Index: {{ "%.2f"|format(bond.index_rate) }}%
                {% endif %}
                {% if bond.notes %}
                  &nbsp;&nbsp;•&nbsp;&nbsp; {{ bond.notes }}
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="10" class="text-center text-muted py-4">No bond positions yet. Add your first bond using the button above.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
